import{reloadFunctions,reloadStyles}from"./index.js";import{ansi4ToAnsi3,ansi8ToAnsi4,hslToRgb,rgbToAnsi8}from"./conversions.js";import{clamp,crayonError}from"./util.js";const colorSupport=new Proxy({threeBitColor:!0,fourBitColor:!0,highColor:!0,trueColor:!0},{});const fourBitColors={black:"[30m",lightBlack:"[90m",red:"[31m",lightRed:"[91m",green:"[32m",lightGreen:"[92m",yellow:"[33m",lightYellow:"[93m",blue:"[34m",lightBlue:"[94m",magenta:"[35m",lightMagenta:"[95m",cyan:"[36m",lightCyan:"[96m",white:"[37m",lightWhite:"[97m"};for(const a in fourBitColors){const b=fourBitColors[a];const c=/[0-9][0-9]/.exec(b);if(c){const d=a[0].toUpperCase()+a.slice(1);const e=c[0];Reflect.set(fourBitColors,`bg${d}`,b.replace(e,String(parseInt(e)+10)))}}const attributes={reset:"[0m",bold:"[1m",dim:"[2m",italic:"[3m",underline:"[4m",blink:"[5m",fastBlink:"[6m",invert:"[7m",hidden:"[8m",strikethrough:"[9m",boldOff:"[21m",doubleUnderline:"[21m",boldOrDimOff:"[22m",italicOff:"[23m",underlineOff:"[24m",blinkOff:"[25m",invertOff:"[26m",hiddenOff:"[27m",strikethroughOff:"[28m"};const functions={keyword(t){const o=styles[t];return o||(crayonError("Invalid keyword given in keyword function"),"")},ansi3(t,o){return("number"!=typeof t||7<t||t<0)&&crayonError("Invalid usage of ansi3 function, syntax: 0-7"),colorSupport.threeBitColor?`\x1b[${(o?40:30)+clamp(t,0,7)}m`:""},ansi4(t,o){return("number"!=typeof t||15<t||t<0)&&crayonError("Invalid usage of ansi4 function, syntax: 0-15"),colorSupport.fourBitColor?`\x1b[${clamp(t,0,15)+(o?10:0)+(7<t?82:30)}m`:functions.ansi3(ansi4ToAnsi3(t),o)},ansi8(t,o){return("number"!=typeof t||255<t||t<0)&&crayonError("Invalid usage of ansi8 function, syntax: 0-255"),colorSupport.highColor?`\x1b[${o?48:38};5;${clamp(t,0,255)}m`:functions.ansi4(ansi8ToAnsi4(t),o)},rgb(t,o,r,n){return("number"!=typeof t||"number"!=typeof o||"number"!=typeof r||255<t||t<0||255<o||o<0||255<r||r<0)&&crayonError("Invalid usage of rgb function, syntax: r: 0-255, g: 0-255, b: 0-255"),colorSupport.trueColor?`\x1b[${n?48:38};2;${t};${o};${r}m`:functions.ansi8(rgbToAnsi8(t,o,r),n)},hsl(t,o,r,n){("number"!=typeof t||"number"!=typeof o||"number"!=typeof r||360<t||t<0||100<o||o<0||100<r||r<0)&&crayonError("Incorrect usage of hsl function, syntax: h: 0-360, s: 0-100, l: 0-100");const e=hslToRgb(t,o,r);return colorSupport.trueColor?functions.rgb(...e,n):functions.ansi8(rgbToAnsi8(...e),n)},hex(t,o,r){if(/#[0-F]{6}/.test(t)){const n=(t=t.slice(1)).match(/.{2}/g);const e=n.map(t=>parseInt(t,16));return o?functions.ansi8(rgbToAnsi8(...e),r):functions.rgb(...e,r)}return crayonError('Incorrect usage of hex function, syntax: "#[0-F]{6}"'),""},bgHex(t,o){return functions.hex(t,o,!0)}};const styles={};Object.assign(styles,attributes,fourBitColors);const addStyleFunction=(t,o)=>{const r=Reflect.set(functions,t,o);return r&&reloadFunctions(),r};const addStyleAlias=(t,o)=>{const r=styles[o];if(r)return crayonError(`Could not find style "${o}"`),!1;const n=Reflect.set(styles,t,r);return n&&reloadStyles(),n};const addStyleAliases=o=>{let r=!0;for(let t in o){const n=o[t];const e=styles[n];e||(crayonError(`Could not find style "${n}"`),r=!1),r=r&&Reflect.set(styles,t,e)}return r&&reloadStyles(),r};const addStyle=(t,o)=>{const r=Reflect.set(styles,t,o);return r&&reloadStyles(),r};const addStyles=t=>{try{return Object.assign(styles,t),reloadStyles(),!0}catch(t){return crayonError(`Failed adding styles:\n${t}`),!1}};export{colorSupport,fourBitColors,attributes,functions,styles,addStyleFunction,addStyleAlias,addStyleAliases,addStyle,addStyles};