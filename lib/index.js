"use strict";const styles_1=require("./styles"),util_1=require("./util"),config=new Proxy({optimizeStyles:{chain:!1,literal:!1},error:util_1.errorConfig},{}),optimizeStyles=e=>e.replace(/(\x1b\[([0-9]|;|)+?m)+\x1b\[0m/,styles_1.styles.reset),crayonPrototype={styleCache:"",preserveCache:!1,config:config,colorSupport:styles_1.colorSupport,instance(e,t){return buildCrayon(e,t)},clone(e,t){return buildCrayon(this.preserveCache,(e?this.clearCache():this.styleCache)+t||"")},clearCache(){var e=this.styleCache;return this.preserveCache||(this.styleCache=""),e},strip(e){return e.replace(/\x1b\[[0-9]([0-9])?([0-9])?m/gi,"")}};for(const h in styles_1.styles)Object.defineProperty(crayonPrototype,h,{get(){return this.clone(!0,styles_1.styles[h])}});for(const i in styles_1.functions)if(!i.startsWith("bg")){const j=`bg${i[0].toUpperCase()+i.slice(1)}`,k=styles_1.functions[i];let t=!1;const m=styles_1.functions[j]||(t=!0,styles_1.functions[i]);Object.defineProperties(crayonPrototype,{[i]:{value(...e){e=k(...e);return e?this.clone(!0,e):this}},[j]:{value(...e){t&&e.push(!0);e=m(...e);return e?this.clone(!0,e):this}}})}const buildCrayon=(e,t)=>{const r=function(...e){if(!e.length)return buildCrayon(!0);if(Array.isArray(e[0].raw)){const s=compileLiteral(...e);return r.config.optimizeStyles?optimizeStyles(s):s}const t=String(e.join(" "));e=r.clearCache();if(!e)return t;const s=e+t.replace(resetRegex,styles_1.styles.reset+e)+styles_1.styles.reset;return r.config.optimizeStyles.chain?optimizeStyles(s):s};return Object.setPrototypeOf(r,crayonPrototype),r.preserveCache=!!e,r.styleCache=t||"",r},resetRegex=/\x1b\[0m/gi,literalStyleRegex=/{([^\s]+\s)([^{}]+)}/,literalFuncRegex=/(\w+)\((.*)\)/,literalStringRegex=/^("|'|`)(.*)\1$/,compileLiteral=(...e)=>{const t=e.slice(1),s=[...e[0]];let r="";for(;t.length||s.length;)r+=(s.shift()||"")+(t.shift()||"");let l=r.match(literalStyleRegex);for(;null!==l&&void 0!==l&&l.length;){var i=l[1].trimEnd().split(".").map(e=>{var t=styles_1.styles[e];if(t)return t;{const s=e.match(literalFuncRegex);if(null!==s&&void 0!==s&&s.length){const r=s[1];t=s[2].split(",").map(e=>{var t=e.match(literalStringRegex);return null!=t&&t.length?t[2]:Number(e)||e});if(r.startsWith("bg")){e=`bg${r[0].toUpperCase()+r.slice(1)}`;const l=styles_1.functions[e]||styles_1.functions[r];if(l)return l(...t,!0)}else{const i=styles_1.functions[r];if(i)return i(...t)}}}}).join(""),n=l[2].split(styles_1.styles.reset).join(styles_1.styles.reset+i);r=r.replace(l[0],i+n+styles_1.styles.reset),l=r.match(literalStyleRegex)}return r},crayonInstance=buildCrayon(!1);module.exports=crayonInstance;