"use strict";var support_1=require("./support"),styles_1=require("./styles"),conversions_1=require("./conversions"),util_1=require("./util"),colorSupport=new Proxy(support_1.getColorSupport(),{}),StyleCache=function(){function n(n,r){this.preserve=n||!1,this.value=r||""}return n.prototype.reset=function(){if(this.preserve)return this.value;var n=this.value;return this.value="",n},n}(),buildCrayon=function(n,r){function t(){}var s=new Proxy(t,crayonHandler);return t.colorSupport=colorSupport,t.$styleCache=new StyleCache(n,r),t.$functions={strip:function(n){return n.replace(/\x1b\[[0-9]([0-9])?([0-9])?m/gi,"")},keyword:function(n){n=styles_1.styles[n];return n&&(t.$styleCache.value+=n),s},hsl:function(n,r,e){var o;return(o=t.$functions).rgb.apply(o,conversions_1.hslToRgb(n,r,e))},bgHsl:function(n,r,e){var o;return(o=t.$functions).bgRgb.apply(o,conversions_1.hslToRgb(n,r,e))},rgb:function(n,r,e){return t.colorSupport.trueColor?(t.$styleCache.value+="[38;2;"+n+";"+r+";"+e+"m",s):t.colorSupport.highColor?t.$functions.ansi8(conversions_1.rgbToAnsi8(n,r,e)):t.$functions.ansi4(conversions_1.rgbToAnsi4(n,r,e))},bgRgb:function(n,r,e){return t.colorSupport.trueColor?(t.$styleCache.value+="[48;2;"+n+";"+r+";"+e+"m",s):t.colorSupport.highColor?t.$functions.bgAnsi8(conversions_1.rgbToAnsi8(n,r,e)):t.$functions.bgAnsi4(conversions_1.rgbToAnsi4(n,r,e))},hex:function(n,r){if(/#[0-F]{6}/.test(n)){var e=(n=n.slice(1)).match(/.{2}/g),o=parseInt(e[0],16),n=parseInt(e[1],16),e=parseInt(e[2],16);return r?t.$functions.ansi8(conversions_1.rgbToAnsi8(o,n,e)):t.$functions.rgb(o,n,e)}return util_1.crayonError("Incorrect usage of hex function"),s},bgHex:function(n,r){if(/#[0-F]{6}/.test(n)){var e=(n=n.slice(1)).match(/.{2}/g),o=parseInt(e[0],16),n=parseInt(e[1],16),e=parseInt(e[2],16);return r?t.$functions.bgAnsi8(conversions_1.rgbToAnsi8(o,n,e)):t.$functions.bgRgb(o,n,e)}return util_1.crayonError("Incorrect usage of bgHex function"),s},ansi8:function(n){return t.colorSupport.highColor?t.$styleCache.value+="[38;5;"+util_1.clamp(n,0,255)+"m":t.$functions.ansi4(conversions_1.ansi8ToAnsi4(n)),s},bgAnsi8:function(n){return t.colorSupport.highColor?t.$styleCache.value+="[48;5;"+util_1.clamp(n,0,255)+"m":t.$functions.bgAnsi4(conversions_1.ansi8ToAnsi4(n)),s},ansi4:function(n){return n=util_1.clamp(n,0,colorSupport.fourBitColor?15:7),t.$styleCache.value+="["+(8<n+n?90:30)+"m",s},bgAnsi4:function(n){return n=util_1.clamp(n,0,colorSupport.fourBitColor?15:7),t.$styleCache.value+="["+(8<n+n?100:40)+"m",s},ansi3:function(n){return t.$styleCache.value+="["+util_1.clamp(n+30,30,37)+"m",s},bgAnsi3:function(n){return t.$styleCache.value+="["+util_1.clamp(n+40,40,47)+"m",s}},s},crayonHandler={apply:function(n,r,e){return e.length?n.$styleCache.reset()+e[0]+"[0m":buildCrayon(!0)},get:function(n,r,e){e=Reflect.get(n,r,e)||Reflect.get(n.$functions,r,e);if(e)return e;r=Reflect.get(styles_1.styles,r);return r&&(n.$styleCache.value+=r),buildCrayon(n.$styleCache.preserve,n.$styleCache.reset())}},crayon=buildCrayon(!1);module.exports=crayon;