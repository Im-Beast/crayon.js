import{addStyle,addStyleAlias,addStyleAliases,addStyleFunction,addStyleFunctions,addStyles,functions,styles}from"./styles.js";import{errorConfig}from"./util.js";const config=new Proxy({colorSupport:{highColor:!0,trueColor:!0,fourBitColor:!0,threeBitColor:!0},optimizeStyles:{chain:!1,literal:!1},errors:errorConfig},{});const optimizeStyles=e=>e.replace(/(\x1b\[([0-9]|;|)+?m)+\x1b\[0m/,styles.reset);const crayonPrototype={styleCache:"",preserveCache:!1,config:config,instance(e,t){return buildCrayon(e,t)},clone(e,t){return buildCrayon(this.preserveCache,(e?this.clearCache():this.styleCache)+(t||""))},clearCache(){const e=this.styleCache;return this.preserveCache||(this.styleCache=""),e},strip(e){return e.replace(/\x1b\[[0-9]([0-9])?([0-9])?m/gi,"")}};const reloadStyles=()=>{for(const e in styles)Object.defineProperty(crayonPrototype,e,{configurable:!0,get(){return this.clone(!0,styles[e])}})};reloadStyles();const reloadFunctions=()=>{for(const e in functions)if(!e.startsWith("bg")){const t=`bg${e[0].toUpperCase()+e.slice(1)}`;const n=functions[e];let s=!1;const r=functions[t]||(s=!0,functions[e]);Object.defineProperties(crayonPrototype,{[e]:{configurable:!0,value(...e){const t=n(...e);return""!==t?this.clone(!0,t):this}},[t]:{configurable:!0,value(...e){s&&e.push(!0);const t=r(...e);return""!==t?this.clone(!0,t):this}}})}};reloadFunctions();const buildCrayon=(e,t)=>{const r=function(...e){if(!e.length)return buildCrayon(!0);if(Array.isArray(e[0].raw)){const n=compileLiteral(...e);return r.config.optimizeStyles.literal?optimizeStyles(n):n}const t=String(e.join(" "));const s=r.clearCache();if(!s)return t;const n=s+t.replace(resetRegex,styles.reset+s)+styles.reset;return r.config.optimizeStyles.chain?optimizeStyles(n):n};return Object.setPrototypeOf(r,crayonPrototype),r.preserveCache=!!e,r.styleCache=t||"",r};const resetRegex=/\x1b\[0m/gi;const literalStyleRegex=/{([^\s]+\s)([^{}]+)}/;const literalFuncRegex=/(\w+)\((.*)\)/;const literalStringRegex=/^("|'|`)(.*)\1$/;const compileLiteral=(...e)=>{const t=e.slice(1);const s=[...e[0]];let n="";for(;t.length||s.length;)s.length&&(n+=s.shift()),t.length&&(n+=t.shift());let r=n.match(literalStyleRegex);for(;null!==r&&void 0!==r&&r.length;){const o=r[1].trimEnd().split(".").map(e=>{const t=styles[e];if(t)return t;{const s=e.match(literalFuncRegex);if(null!==s&&void 0!==s&&s.length){const n=s[1];const r=s[2].split(",").map(e=>{const t=e.match(literalStringRegex);if(null!=t&&t.length)return t[2];const s=Number(e);return s||("false"===e||"true"===e?Boolean(e):e)});if(n.startsWith("bg")){const o=n[2].toLowerCase()+n.replace("bg","").substr(1);const l=functions[n]||(r.push(!0),functions[o]);if(l)return l(...r)}else{const i=functions[n];if(i)return i(...r)}}}}).join("");const l=r[2].split(styles.reset).join(styles.reset+o);n=n.replace(r[0],o+l+styles.reset),r=n.match(literalStyleRegex)}return n};const crayonInstance=buildCrayon(!1);export default crayonInstance;export{config,reloadStyles,reloadFunctions,addStyleFunction,addStyleFunctions,addStyleAlias,addStyleAliases,addStyle,addStyles,optimizeStyles,functions,styles};