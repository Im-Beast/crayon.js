import{colorSupport,functions,styles}from"./styles.js";import{errorConfig}from"./util.js";const config=new Proxy({colorSupport:colorSupport,optimizeStyles:{chain:!1,literal:!1},errors:errorConfig},{});const optimizeStyles=t=>t.replace(/(\x1b\[([0-9]|;|)+?m)+\x1b\[0m/,styles.reset);const crayonPrototype={styleCache:"",preserveCache:!1,config:config,colorSupport:colorSupport,instance(t,e){return buildCrayon(t,e)},clone(t,e){return buildCrayon(this.preserveCache,(t?this.clearCache():this.styleCache)+(e||""))},clearCache(){const t=this.styleCache;return this.preserveCache||(this.styleCache=""),t},strip(t){return t.replace(/\x1b\[[0-9]([0-9])?([0-9])?m/gi,"")}};for(const h in styles)Object.defineProperty(crayonPrototype,h,{get(){return this.clone(!0,styles[h])}});for(const i in functions)if(!i.startsWith("bg")){const j=`bg${i[0].toUpperCase()+i.slice(1)}`;const k=functions[i];let r=!1;const m=functions[j]||(r=!0,functions[i]);Object.defineProperties(crayonPrototype,{[i]:{value(...t){const e=k(...t);return""!==e?this.clone(!0,e):this}},[j]:{value(...t){r&&t.push(!0);const e=m(...t);return""!==e?this.clone(!0,e):this}}})}const buildCrayon=(t,e)=>{const n=function(...t){if(!t.length)return buildCrayon(!0);if(Array.isArray(t[0].raw)){const s=compileLiteral(...t);return n.config.optimizeStyles.literal?optimizeStyles(s):s}const e=String(t.join(" "));const r=n.clearCache();if(!r)return e;const s=r+e.replace(resetRegex,styles.reset+r)+styles.reset;return n.config.optimizeStyles.chain?optimizeStyles(s):s};return Object.setPrototypeOf(n,crayonPrototype),n.preserveCache=!!t,n.styleCache=e||"",n};const resetRegex=/\x1b\[0m/gi;const literalStyleRegex=/{([^\s]+\s)([^{}]+)}/;const literalFuncRegex=/(\w+)\((.*)\)/;const literalStringRegex=/^("|'|`)(.*)\1$/;const compileLiteral=(...t)=>{const e=t.slice(1);const r=[...t[0]];let s="";for(;e.length||r.length;)r.length&&(s+=r.shift()),e.length&&(s+=e.shift());let n=s.match(literalStyleRegex);for(;null!==n&&void 0!==n&&n.length;){const o=n[1].trimEnd().split(".").map(t=>{const e=styles[t];if(e)return e;{const r=t.match(literalFuncRegex);if(null!==r&&void 0!==r&&r.length){const s=r[1];const n=r[2].split(",").map(t=>{const e=t.match(literalStringRegex);if(null!=e&&e.length)return e[2];const r=Number(t);return r||("false"===t||"true"===t?Boolean(t):t)});if(s.startsWith("bg")){const o=s[2].toLowerCase()+s.replace("bg","").substr(1);const c=functions[s]||(n.push(!0),functions[o]);if(c)return c(...n)}else{const i=functions[s];if(i)return i(...n)}}}}).join("");const c=n[2].split(styles.reset).join(styles.reset+o);s=s.replace(n[0],o+c+styles.reset),n=s.match(literalStyleRegex)}return s};const crayonInstance=buildCrayon(!1);export default crayonInstance;export{crayonInstance as crayon,optimizeStyles,colorSupport,functions,styles};